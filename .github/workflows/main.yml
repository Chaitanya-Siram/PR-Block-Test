name: Block Merge Based on Time

on:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
      - labeled
      - unlabeled
  schedule:
    - cron: "10 12 * * *"  # Runs daily at 12:10 PM UTC (5:40 PM IST)

jobs:
  block:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      statuses: write
    steps:
      - uses: yykamei/block-merge-based-on-time@main
        id: block
        with:
          timezone: Asia/Kolkata
          after: "17:45"   # 5:45 PM IST
          before: "18:00"  # 6:00 PM IST
          base-branches: "main"
          prohibited-days-dates: ""  # No specific days blocked, applies every day

      - name: Notify in PR comment if blocked
        if: steps.block.outputs.pr-blocked == 'true'
        run: |
          gh pr comment ${{ github.event.pull_request.html_url }} --body "ðŸš¨ **Merging is blocked from 5:45 PM to 6:00 PM IST** ðŸš¨"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Fail if PR is blocked
        if: steps.block.outputs.pr-blocked == 'true'
        run: |
          echo "Merging is blocked during this time window!"
          exit 1